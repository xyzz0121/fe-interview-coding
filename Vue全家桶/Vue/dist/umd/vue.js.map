{"version":3,"file":"vue.js","sources":["../../src/compiler/generate.js","../../src/compiler/perse.js","../../src/compiler/index.js","../../src/vdom/patch.js","../../src/lifecycle.js","../../src/util.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/vdom/index.js","../../src/index.js"],"sourcesContent":["//把ast元素的属性，生成render字符串\nfunction genProps(attrs){\n    let str = '' ;\n    attrs.forEach(attr => {\n        if (attr.name === \"style\") { //style比较特殊 进行特殊处理\n            let obj = {};\n            attr.value.split(';').forEach(item => {\n                let [key, value] = item.split(':');\n                obj[key] = value;\n            });\n            attr.value = obj;\n        }\n        str += `${attr.name}:${JSON.stringify(attr.value)},`\n    });\n    return `{${str.slice(0, -1)}}`;  //去掉多余逗号\n}\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\n\nfunction gen(node) {\n    if (node.type === 1) {\n        return generate(node);\n    }else{\n        const text = node.text;\n        //如果不存在 {{}} 这种变量\n        if (!defaultTagRE.test(text)) {\n            return `_v(${JSON.stringify(text)})`\n        }\n        //存在的话，用正则一点点把字符串拆开，给变量加上 _s()\n        let tokens = []; //存放每一段代码\n        let lastIndex = defaultTagRE.lastIndex = 0; //全局模式，每次index置为0 , 因为上面执行了一次 defaultTagRE.test 所以政策而index要归位\n        let match, index; // 匹配到的结果\n        while (match = defaultTagRE.exec(text)) {\n            index = match.index;\n            //说明匹配到的结果不是第一个元素，那说明前面这部分是普通字符串\n            if (index > lastIndex) {\n                tokens.push(JSON.stringify(text.slice(lastIndex, index)));\n            }\n            tokens.push(`_s(${match[1].trim()})`);\n            lastIndex = index + match[0].length;\n        }\n        if (lastIndex < text.length) {\n            tokens.push(JSON.stringify(text.slice(lastIndex)));\n        }\n        return `_v(${tokens.join('+')})`;\n\n    }   \n}\n\nfunction genChildren(el) {\n    const children = el.children;\n    if (children) {\n        return children.map(child => gen(child)).join(',')\n    }\n}\n\n//核心就是拼遍历ast，然后生成render函数的字符串\nexport function generate(el) {\n    const children = genChildren(el);\n    // _c: 创建元素  _v: 创建文本  _s: {{}}变量\n    let code = `_c('${el.tag}', ${\n        el.attrs.length ? `${genProps(el.attrs)}` : 'undefined'        //有属性、组合属性字符串\n    }${\n        children ? `, ${children}` : ''\n    })`;\n\n    return code;\n}","//解析html的正则表达式们\nconst unicodeRegExp = /a-zA-Z\\u00B7\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u203F-\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD/;\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst ncname = \"[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z\" + (unicodeRegExp.source) + \"]*\";\nconst qnameCapture = \"((?:\" + ncname + \"\\\\:)?\" + ncname + \")\";\nconst startTagOpen = new RegExp((\"^<\" + qnameCapture));\nconst startTagClose = /^\\s*(\\/?)>/;\nconst endTag = new RegExp((\"^<\\\\/\" + qnameCapture + \"[^>]*>\"));\n\n//html to ast\nexport function parseHTML(html) {\n    function createASTElement(tagName, attrs) {\n        return {\n            tag: tagName,\n            type: 1, //html 元素 type是1\n            children: [],\n            attrs,\n            parent: null\n        }\n    }\n    let root;\n    let currentParent;\n    let stack = []; //用栈 判断标签时候合法\n    function start(tagName, attrs) {\n        let element = createASTElement(tagName, attrs);\n        if (!root) {\n            root = element;\n        }\n        currentParent = element;\n        stack.push(element);\n    }\n\n    function end(tagName) {\n        let element = stack.pop(); //取出栈最后一个 进行比较 看看标签是否配对\n        currentParent = stack[stack.length-1];\n        if (currentParent) { //闭合时知道，当前标签的父子关系\n            element.parent = currentParent;\n            currentParent.children.push(element);\n        }\n    }\n\n    function chars(text) {\n        text = text.replace(/\\s/g, '');\n        if (text) {\n            currentParent.children.push({\n                type: 3,//html 文本 type是3\n                text\n            })\n        }\n    }\n\n    //解析过程 边解析边删除，直到所有解析完成\n    while (html) { //只要Html不空，就一直解析\n        //观察规律，看当前第一个字符是不是 < ，是 < 就一定是一个标签\n        let textEnd = html.indexOf(\"<\");\n        if (textEnd === 0) {\n            //TODO: v-bind :value 等等\n            //先看看是不是开始标签，那么先解析开始标签\n            const startTagMatch = parseStartTag();\n            if (startTagMatch) {\n                start(startTagMatch.tagName, startTagMatch.attrs);\n                continue;\n            }\n            //不是开始标签，就是结束标签\n            const endTagMatch = html.match(endTag);\n            if (endTagMatch) {\n                end(endTagMatch[0]);\n                advance(endTagMatch[0].length);\n                continue;\n            }\n        }\n        let text;\n        //< 位置 大于0 当前字符串是文本\n        if (textEnd > 0) {\n            text = html.substring(0, textEnd);\n        }\n        //有文本 记录文本 删除文本\n        if (text) {\n            advance(text.length);\n            chars(text);\n        }\n    }\n\n    function advance(n) { //截取掉匹配到内容，重新更新html\n        html = html.substring(n);\n    }\n\n    function parseStartTag() {\n        const start = html.match(startTagOpen);\n        if (start) {\n            const match = {\n                tagName: start[1],\n                attrs: []\n            };\n            advance(start[0].length);\n            //开始标签截取完了，该匹配属性了, 好多属性，所以要遍历\n            //如果是开始标签结束了，那么没有属性了，所以先判断 开始标签没有结束\n            let end, attr;\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute))) {\n                match.attrs.push({\n                    name: attr[1],\n                    value: attr[3] || attr[4] || attr[5] //属性的三种写法，match出来结果，在数组的不同位置\n                });\n                advance(attr[0].length);\n            }\n            //如果开始标签结束了\n            if (end) {\n                advance(end[0].length);\n                return match;\n            }\n        }\n    }\n    return root;\n}","import { generate } from \"./generate\";\nimport { parseHTML } from \"./perse\";\n\n//把template编译成render函数\nexport function compileToFunctions(template) {\n    //1、html转成AST\n    const ast = parseHTML(template);\n\n    //2、TODO:优化静态节点\n\n    //3、AST重新生成代码\n    const code = generate(ast);\n    \n    //4、把code字符串转化成真正的函数 通过with进行设置取值\n    const render = new Function(`with(this){return ${code}}`);\n\n    return render;\n    \n}","export function patch(oldVnode, vnode){\n    //将虚拟dom转化为真实节点 递归创建元素的过程\n    // oldVnode => id#app  vnode => 我们根据模板产生的虚拟dom\n    let el = createElm(vnode); //产生真实dom\n    let parentElm = oldVnode.parentNode; // 获取旧的节点的父亲\n    console.log(parentElm);\n    //为什么insertBefore 保留原来的位置\n    parentElm.insertBefore(el, oldVnode.nextSibiling);//当前真实元素插入到app的后面\n    parentElm.removeChild(oldVnode); //删除旧的节点\n}\n\nfunction createElm(vnode){\n    let { tag, data, key, children, text} = vnode;\n    if (typeof tag === \"string\") { //创建元素，放到vnode.el上\n        vnode.el = document.createElement(tag);\n\n        //只有元素才有属性\n        updateProperties(vnode);\n        children.forEach(child => {\n            vnode.el.appendChild(createElm(child));\n        });\n    }else{ \n        vnode.el = document.createTextNode(text)\n    }\n    return vnode.el;\n}\n\nfunction updateProperties(vnode){\n    let el = vnode.el;\n    let newProps = vnode.data || {};\n\n    for (const key in newProps) {\n        if (key == \"style\") {\n            for (const styleName in newProps.style) {\n                el.style[styleName] = newProps.style[styleName];\n                console.log(el);\n            }\n        }else if(key === \"class\"){\n            el.className = newProps[key];\n        }else{\n            el.setAttribute(key, newProps[key]);\n        }\n    }\n}","import { patch } from \"./vdom/patch\";\n\nexport function lifecycleMixin(Vue){\n    Vue.prototype._update = function(vnode){\n        const vm = this;\n        patch(vm.$el, vnode);\n    }\n}\n\nexport function mountComponent(vm, el){ \n    //先调用render方法创建虚拟节点，再将虚拟节点渲染到页面上 vue核心！！！！\n    vm._update(vm._render());\n}  ","//访问和设置vm，代理到访问和设置vm[data]\nexport function proxy(vm, data, key) {\n    Object.defineProperty(vm, key, {\n        get(){\n            return vm[data][key]\n        },\n        set(newValue){\n            vm[data][key] = newValue\n        }\n    })\n}\n//添加不可枚举、不可遍历的属性\nexport function defineProperty(data, key, value) {\n    Object.defineProperty(data, key, {\n        enumerable: false, //不可枚举，不能被循环出来，相当于隐藏属性\n        configurable: false,\n        value\n    })\n}","/**\n * 重写数组方法\n * 思路：先继承，后重写，用的时候，先找实例\n */\n\nconst oldArrayProtoMethods = Array.prototype;\n\nexport const arrayMethods = Object.create(oldArrayProtoMethods);\n\nconst methods = [\n    \"push\",\n    \"pop\",\n    \"shift\",\n    \"unshift\",\n    \"sort\",\n    \"reverse\",\n    \"splice\",\n];\n//先走自己的逻辑，然后调用原来的逻辑\nmethods.forEach(method => {\n    arrayMethods[method] = function (...args) {\n        console.log(\"数组方法被调用了\", method);\n        const ob = this.__ob__;\n        const result = oldArrayProtoMethods[method].apply(this, args); //this 就是 observer constructor里的data\n        let inserted;\n        //数组增加项，有可能是对象类型，应该再次被观测\n        switch (method) {\n            case \"push\":\n            case \"unshift\":\n                inserted = args;\n                break;\n            case \"splice\":\n                inserted = args.slice(2);\n            default:\n                break;\n        }\n        if (inserted) {\n            ob.observeArray(inserted);\n        }\n\n        return result;\n    }\n})","import { defineProperty } from \"../util\";\nimport { arrayMethods } from \"./array\";\n\n/**\n * 用 defineProperty 递归把data所有属性都变成响应式\n */\nclass Observer{\n    constructor(data){\n        //hack骚操作，把observeArray挂在调用函数的this上，在array.js里还可以使用。同时也可以标记对象或者数组已经被观测。\n        defineProperty(data, \"__ob__\", this);\n        //一步一步把defineProperty全都重新定义一下 使原来的对象每个属性发生变化的时候 都能get到，也就是将一个普通对象变成一个响应式对象\n        if (Array.isArray(data)) {\n            //函数劫持 考虑性能原因 不使用defineproperty 选择重新方法\n            data.__proto__ = arrayMethods;\n            //如果数组里嵌套对象，还需要监控对象\n            this.observeArray(data);\n        } else {\n            this.walk(data);\n        }\n    }\n    observeArray(data){\n        data.forEach(item => {\n            observe(item);\n        })\n    }\n    walk(data){\n        const keys = Object.keys(data);\n        keys.forEach(key => {\n            defineReactive(data, key, data[key]); \n        })\n    }\n}\n//Vue.util.defineReactive 把对象的某个属性变成响应式\nfunction defineReactive(data, key, value) {\n    observe(value);\n    Object.defineProperty(data, key, {\n        get(){\n            return value\n        },\n        set(newValue){\n            if(value === newValue) return ;\n            observe(newValue);\n            value = newValue;\n        }\n    })\n}\n\n\n\nexport function observe(data) {\n    if(typeof data !== \"object\" || data == null || data.__ob__){\n        return ;\n    }\n    return new Observer(data);\n}","import { observe } from \"./observer/index\";\nimport { proxy } from \"./util\";\n\nexport function initState(vm) {\n    const opts = vm.$options;\n    //按照优先级先后初始化，如果后面的和前面的重名了，怎么怎么样\n    if (opts.props) {\n        initProps(vm);\n    }\n    if (opts.methods) {\n        initMethods(vm);\n    }\n    if (opts.data) {\n        initData(vm);\n    }\n    if (opts.watch) {\n        initWatch(vm);\n    }\n    if (opts.computed) {\n        initComputed(vm);\n    }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction initData(vm) {\n    let data = vm.$options.data;\n    //保存所有data，\n    vm._data = data = typeof data ? data.call(vm) : data;\n\n    //把vm.arr 代理到 vm._data.arr 实现真正的获取data\n    for (const key in data) {\n        proxy(vm, \"_data\", key);\n    }\n    //有对象了 就要劫持 \n    //对象的劫持方案：object.defineProperty();\n    //对象里嵌套数组的劫持方案: 单独处理\n    observe(data); //让对象重新定义set get\n}\n\nfunction initWatch() {}\n\nfunction initComputed() {}","import { compileToFunctions } from \"./compiler/index\";\nimport { mountComponent } from \"./lifecycle\";\nimport { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this;\n        vm.$options = options;\n        //所有初始化操作，都在initState里\n        initState(vm);\n        // initEvents();\n        //需要渲染元素\n        if (vm.$options.el) {\n            vm.$mount(vm.$options.el);\n        }\n    }\n\n    Vue.prototype.$mount = function (el) {\n        const vm = this;\n        const options = vm.$options;\n        el = document.querySelector(el);\n        vm.$el = el;\n        //按照优先级处理，保证最后统一为 render函数渲染\n        if (!options.render) {\n            let template = options.template;\n            if (!template && el) {\n                template = el.outerHTML;\n            }\n            const render = compileToFunctions(template);\n            options.render = render;\n        }\n        //这里保证有render方法，开始渲染挂载元素\n        mountComponent(vm, el)\n    }\n}","export function renderMixin(Vue){\n    //创建元素\n    Vue.prototype._c = function(){\n        return createElement(...arguments);\n    }\n    //stringify\n    Vue.prototype._s = function(val){\n        return val == null ? \"\" : typeof val === \"object\" ? JSON.stringify(val) : val;\n    }\n    //创建文本元素\n    Vue.prototype._v = function(text){\n        return createTextVnode(text);\n    }\n \n    Vue.prototype._render = function(){\n        const vm = this;\n        const render = vm.$options.render;\n        let vnode = render.call(vm);\n        return vnode ;\n    }\n}\n\nfunction createElement(tag, data={}, ...children){\n    return vnode(tag, data, data.key, children);\n}\n\nfunction createTextVnode(text){\n    return vnode(undefined, undefined, undefined, undefined, text);\n}\n\n//产生虚拟dom的\nfunction vnode(tag, data, key, children, text){\n    return {\n        tag,\n        data,\n        key,\n        children,\n        text\n    }\n}","import { initMixin } from \"./init\";\nimport { lifecycleMixin } from \"./lifecycle\";\nimport { renderMixin } from \"./vdom/index\";\n\n/**\n * Vue 类的声明\n * @param {object} options 用户 new Vue() 时传的配置对象\n */\nfunction Vue(options) {\n    this._init(options); //组件初始化的入口\n}\n\n//Vue把原型方法拆成一个一个又一个的插件，利于拆分，结构拆分，所有原型拓展都在这里\n\n//插件1：初始化操作都在这里\ninitMixin(Vue);\n//插件2：生命周期，其实就是渲染 指的是组件的生命周期 不是常规的生命周期  组件的挂载、更新\nlifecycleMixin(Vue);\n//插件3：render生成虚拟dom\nrenderMixin(Vue);\n\n\nexport default Vue;"],"names":["genProps","attrs","str","forEach","attr","name","obj","value","split","item","key","JSON","stringify","slice","defaultTagRE","gen","node","type","generate","text","test","tokens","lastIndex","match","index","exec","push","trim","length","join","genChildren","el","children","map","child","code","tag","unicodeRegExp","attribute","ncname","source","qnameCapture","startTagOpen","RegExp","startTagClose","endTag","parseHTML","html","createASTElement","tagName","parent","root","currentParent","stack","start","element","end","pop","chars","replace","textEnd","indexOf","startTagMatch","parseStartTag","endTagMatch","advance","substring","n","compileToFunctions","template","ast","render","Function","patch","oldVnode","vnode","createElm","parentElm","parentNode","console","log","insertBefore","nextSibiling","removeChild","data","document","createElement","updateProperties","appendChild","createTextNode","newProps","styleName","style","className","setAttribute","lifecycleMixin","Vue","prototype","_update","vm","$el","mountComponent","_render","proxy","Object","defineProperty","get","set","newValue","enumerable","configurable","oldArrayProtoMethods","Array","arrayMethods","create","methods","method","ob","__ob__","args","result","apply","inserted","observeArray","Observer","isArray","__proto__","walk","observe","keys","defineReactive","initState","opts","$options","props","initData","watch","computed","_data","call","initMixin","_init","options","$mount","querySelector","outerHTML","renderMixin","_c","arguments","_s","val","_v","createTextVnode","undefined"],"mappings":"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"}