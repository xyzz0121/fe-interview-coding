{"version":3,"file":"vue.js","sources":["../../src/compiler/index.js","../../src/util.js","../../src/observer/array.js","../../src/observer/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["\n//解析html的正则表达式们\nconst unicodeRegExp = /a-zA-Z\\u00B7\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u203F-\\u2040\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD/;\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst dynamicArgAttribute = /^\\s*((?:v-[\\w-]+:|@|:|#)\\[[^=]+\\][^\\s\"'<>\\/=]*)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\nconst ncname = \"[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z\" + (unicodeRegExp.source) + \"]*\";\nconst qnameCapture = \"((?:\" + ncname + \"\\\\:)?\" + ncname + \")\";\nconst startTagOpen = new RegExp((\"^<\" + qnameCapture));\nconst startTagClose = /^\\s*(\\/?)>/;\nconst endTag = new RegExp((\"^<\\\\/\" + qnameCapture + \"[^>]*>\"));\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g;\n\nfunction start(tagName, attrs) {\n    console.log(tagName);\n    console.log(attrs);\n}\n\nfunction end(tagName) {\n    \n}\n\nfunction chars(text) {\n    \n}\n\n//html to ast\nfunction parseHTML(html) {\n    //解析过程 边解析边删除，直到所有解析完成\n    while (html) { //只要Html不空，就一直解析\n        //观察规律，看当前第一个字符是不是 < ，是 < 就一定是一个标签\n        let textEnd = html.indexOf(\"<\");\n        if (textEnd === 0) {\n            //先看看是不是开始标签，那么先解析开始标签\n            const startTagMatch = parseStartTag();\n            if (startTagMatch) {\n                start(startTagMatch.tagName, startTagMatch.attrs);\n            }\n            break;\n        }\n    }\n    function advance(n) { //截取掉匹配到内容，重新更新html\n        html = html.substring(n); \n    }\n    function parseStartTag() {\n        const start = html.match(startTagOpen);\n        if (start) {\n            const match = {\n                tagName: start[1],\n                attrs: []\n            };\n            advance(start[0].length);\n            //开始标签截取完了，该匹配属性了, 好多属性，所以要遍历\n            //如果是开始标签结束了，那么没有属性了，所以先判断 开始标签没有结束\n            let end, attr ;\n            while (!(end = html.match(startTagClose)) && (attr = html.match(attribute)) ) {\n                match.attrs.push({\n                    name: attr[1],\n                    value: attr[3] || attr[4] || attr[5] //属性的三种写法，match出来结果，在数组的不同位置\n                });\n                advance(attr[0].length);\n            }\n            //如果开始标签结束了\n            if (end) {\n                advance(end[0].length);\n                return match;\n            }\n        }\n    }\n}\n\n//把template编译成render函数\nexport function compileToFunctions(template) {\n    let ast = parseHTML(template);\n}","//访问和设置vm，代理到访问和设置vm[data]\nexport function proxy(vm, data, key) {\n    Object.defineProperty(vm, key, {\n        get(){\n            return vm[data][key]\n        },\n        set(newValue){\n            vm[data][key] = newValue\n        }\n    })\n}\n//添加不可枚举、不可遍历的属性\nexport function defineProperty(data, key, value) {\n    Object.defineProperty(data, key, {\n        enumerable: false, //不可枚举，不能被循环出来，相当于隐藏属性\n        configurable: false,\n        value\n    })\n}","/**\n * 重写数组方法\n * 思路：先继承，后重写，用的时候，先找实例\n */\n\nconst oldArrayProtoMethods = Array.prototype;\n\nexport const arrayMethods = Object.create(oldArrayProtoMethods);\n\nconst methods = [\n    \"push\",\n    \"pop\",\n    \"shift\",\n    \"unshift\",\n    \"sort\",\n    \"reverse\",\n    \"splice\",\n];\n//先走自己的逻辑，然后调用原来的逻辑\nmethods.forEach(method => {\n    arrayMethods[method] = function (...args) {\n        console.log(\"数组方法被调用了\", method);\n        const ob = this.__ob__;\n        const result = oldArrayProtoMethods[method].apply(this, args); //this 就是 observer constructor里的data\n        let inserted;\n        //数组增加项，有可能是对象类型，应该再次被观测\n        switch (method) {\n            case \"push\":\n            case \"unshift\":\n                inserted = args;\n                break;\n            case \"splice\":\n                inserted = args.slice(2);\n            default:\n                break;\n        }\n        if (inserted) {\n            ob.observeArray(inserted);\n        }\n\n        return result;\n    }\n})","import { defineProperty } from \"../util\";\nimport { arrayMethods } from \"./array\";\n\n/**\n * 用 defineProperty 递归把data所有属性都变成响应式\n */\nclass Observer{\n    constructor(data){\n        //hack骚操作，把observeArray挂在调用函数的this上，在array.js里还可以使用。同时也可以标记对象或者数组已经被观测。\n        defineProperty(data, \"__ob__\", this);\n        //一步一步把defineProperty全都重新定义一下 使原来的对象每个属性发生变化的时候 都能get到，也就是将一个普通对象变成一个响应式对象\n        if (Array.isArray(data)) {\n            //函数劫持\n            data.__proto__ = arrayMethods;\n            //如果数组里嵌套对象，还需要监控对象\n            this.observeArray(data);\n        } else {\n            this.walk(data);\n        }\n    }\n    observeArray(data){\n        data.forEach(item => {\n            observe(item);\n        })\n    }\n    walk(data){\n        const keys = Object.keys(data);\n        keys.forEach(key => {\n            defineReactive(data, key, data[key]); \n        })\n    }\n}\n//Vue.util.defineReactive 把对象的某个属性变成响应式\nfunction defineReactive(data, key, value) {\n    observe(value);\n    Object.defineProperty(data, key, {\n        get(){\n            console.log(\"获取\", key, value);\n            return value\n        },\n        set(newValue){\n            console.log(\"设置\", key, value);\n            if(value === newValue) return ;\n            observe(newValue);\n            value = newValue;\n        }\n    })\n}\n\n\n\nexport function observe(data) {\n    if(typeof data !== \"object\" || data == null || data.__ob__){\n        return ;\n    }\n    return new Observer(data);\n}","import { observe } from \"./observer/index\";\nimport { proxy } from \"./util\";\n\nexport function initState(vm) {\n    const opts = vm.$options;\n    //按照优先级先后初始化，如果后面的和前面的重名了，怎么怎么样\n    if (opts.props) {\n        initProps(vm);\n    }\n    if (opts.methods) {\n        initMethods(vm);\n    }\n    if (opts.data) {\n        initData(vm);\n    }\n    if (opts.watch) {\n        initWatch(vm);\n    }\n    if (opts.computed) {\n        initComputed(vm);\n    }\n}\n\nfunction initProps() {}\n\nfunction initMethods() {}\n\nfunction initData(vm) {\n    let data = vm.$options.data;\n    vm._data = data = typeof data ? data.call(vm) : data;\n\n    //把vm.arr 代理到 vm._data.arr 实现真正的获取data\n    for (const key in data) {\n        proxy(vm, \"_data\", key);\n    }\n    //有对象了 就要劫持 \n    //对象的劫持方案：object.defineProperty();\n    //对象里嵌套数组的劫持方案: 单独处理\n    observe(data);\n}\n\nfunction initWatch() {}\n\nfunction initComputed() {}","import { compileToFunctions } from \"./compiler/index\";\nimport { initState } from \"./state\";\n\nexport function initMixin(Vue) {\n    Vue.prototype._init = function (options) {\n        const vm = this;\n        vm.$options = options;\n        //所有初始化操作，都在initState里\n        initState(vm);\n        // initEvents();\n        //需要渲染元素\n        if (vm.$options.el) {\n            vm.$mount(vm.$options.el);\n        }\n    }\n\n    Vue.prototype.$mount = function (el) {\n        const vm = this;\n        const options = vm.$options;\n        el = document.querySelector(el);\n        //按照优先级处理，保证最后统一为 render函数渲染\n        if (!options.render) {\n            let template = options.template;\n            if (!template && el) {\n                template = el.outerHTML;\n            }\n            const render = compileToFunctions(template);\n            options.render = render;\n        }\n    }\n}","import { initMixin } from \"./init\";\n\n/**\n * Vue 类的声明\n * @param {object} options 用户 new Vue() 时传的配置对象\n */\nfunction Vue(options) {\n    this._init(options);\n}\n\n//Vue把原型方法拆成一个一个又一个的插件，利于拆分，结构拆分，所有原型拓展都在这里\n\n//插件1：初始化操作都在这里\ninitMixin(Vue);\n\nexport default Vue;"],"names":["unicodeRegExp","attribute","ncname","source","qnameCapture","startTagOpen","RegExp","startTagClose","start","tagName","attrs","console","log","parseHTML","html","textEnd","indexOf","startTagMatch","parseStartTag","advance","n","substring","match","length","end","attr","push","name","value","compileToFunctions","template","proxy","vm","data","key","Object","defineProperty","get","set","newValue","enumerable","configurable","oldArrayProtoMethods","Array","prototype","arrayMethods","create","methods","forEach","method","ob","__ob__","args","result","apply","inserted","slice","observeArray","Observer","isArray","__proto__","walk","item","observe","keys","defineReactive","initState","opts","$options","props","initData","watch","computed","_data","call","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}